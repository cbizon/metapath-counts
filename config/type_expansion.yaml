# Configuration for Hierarchical Type Expansion
#
# This file controls how nodes participate in multiple type hierarchies
# when building metapath matrices.

# Type Expansion Settings
type_expansion:
  # Enable hierarchical type expansion (nodes participate as all their types)
  enabled: true

  # Maximum depth to expand in type hierarchy
  # null = no limit (include all types)
  # 1 = only most specific type (disables expansion)
  # 2 = most specific + 1 parent level
  # 3 = most specific + 2 parent levels
  max_depth: null

  # Biolink types to exclude from expansion
  # These are typically very abstract types that don't add value
  # and cause matrix explosion without improving rule mining
  exclude_types:
    - ThingWithTaxon
    - SubjectOfInvestigation
    - PhysicalEssenceOrOccurrent
    - PhysicalEssence
    - OntologyClass
    - Occurrent
    - InformationContentEntity
    - Attribute

  # Always include the most specific type even if it would be filtered
  # Recommended: true (ensures at least one type per node)
  include_most_specific: true

# Error Handling Settings
error_handling:
  # Skip individual paths that encounter OOM errors instead of failing entire job
  skip_on_oom: true

  # Maximum memory threshold (GB) for path computation
  # Paths predicted to exceed this will be skipped preemptively
  # Set to null to disable prediction-based skipping
  # Recommended: Set slightly below your SLURM max memory tier (e.g., 1400 for 1.5TB limit)
  max_memory_gb: 1400

  # Timeout per individual N-hop path computation (seconds)
  # Prevents infinite loops from blocking progress
  # Set to null to disable timeouts
  # Recommended: 300 (5 minutes) for 3-hop, adjust for N-hop
  timeout_per_path_sec: 300

# Output Settings
output:
  # Write skipped paths to jsonl files for analysis
  # Useful for understanding what paths couldn't be computed and why
  write_skipped_paths: true

  # How often to flush results to disk
  # Options:
  #   "per_path": Flush after every path (safest, never lose completed work)
  #   "per_row": Flush after every result row (similar to per_path)
  #   <number>: Flush every N rows (faster but lose N rows on OOM)
  # Recommended: "per_path" for hierarchical types (OOM more likely)
  checkpoint_frequency: "per_path"

# Memory Estimation Settings
memory_estimation:
  # Enable memory prediction before attempting path computation
  enabled: true

  # Bytes per matrix element (for boolean sparse matrices)
  # GraphBLAS uses ~8 bytes per non-zero entry for indices + 1 byte for boolean value
  bytes_per_element: 9

  # Safety factor for memory estimation (multiply prediction by this)
  # Accounts for intermediate computations and overhead
  # Recommended: 2.0 (2x the predicted requirement)
  safety_factor: 2.0

  # Result sparsity heuristic
  # Estimate result matrix sparsity as: min(sparsity1 * sparsity2 * factor, 1.0)
  # Lower = more conservative (higher memory estimate)
  # Higher = more aggressive (lower memory estimate)
  # Recommended: 10.0 for knowledge graphs (very sparse results expected)
  sparsity_factor: 10.0

# Job Scheduling Settings
job_scheduling:
  # Sort jobs by estimated memory (smallest first)
  # Helps maximize throughput by running easy jobs first
  sort_by_memory: true

  # Skip jobs predicted to exceed max_memory_gb
  # If false, attempt all jobs regardless of prediction
  skip_large_jobs: false

  # Maximum number of concurrent SLURM jobs
  # Adjusted dynamically by hop count in orchestrator
  # This is the base value for 3-hop
  max_concurrent_jobs: 10

# Logging Settings
logging:
  # Log level: DEBUG, INFO, WARNING, ERROR
  level: INFO

  # Log statistics about type expansion
  log_type_statistics: true

  # Log memory estimates for each path
  log_memory_estimates: false

  # Log skipped path reasons
  log_skip_reasons: true
